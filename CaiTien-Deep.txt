var monDangKy =
"CS406.Q12.1,SE357.Q11.1,CS406.Q12,SE357.Q11"; 
var classCodes = monDangKy.split(",");

function waitForElement(selector) {
  return new Promise((resolve) => {
    if (document.querySelector(selector)) {
      return resolve(document.querySelector(selector));
    }
    const observer = new MutationObserver((mutations) => {
      if (document.querySelector(selector)) {
        resolve(document.querySelector(selector));
        observer.disconnect();
      }
    });
    observer.observe(document.body, {
      childList: true,
      subtree: true,
    });
  });
}

function handleSearch(rows) {
  function findClassCode(classCode) {
    for (let row of rows) {
      var checkbox = row.getElementsByTagName("input")[0];
      var cells = row.getElementsByTagName("td");
      if (cells[1].innerHTML == classCode) {
        checkbox.click();
        console.log("Đã tìm thấy và check: " + cells[1].innerHTML);
        break;
      }
    }
  }
  for (let i = 0; i < classCodes.length; i++) {
    findClassCode(classCodes[i]);
  }
}

waitForElement("tbody > tr").then((element) => {
  var table = document.getElementsByTagName("tbody")[0];
  var rows = table.getElementsByTagName("tr");
  handleSearch(rows);
  waitForElement(".detailBar button.chakra-button, input[type='submit'][value*='Đăng'], button[type='submit'], .btn-submit, #submit-btn").then((element) => {
    element.click();
  });
  return "Done";
});
